{
  "realm": "foo",
  "name": "foreach.tract",
  "type": "tract",
  "actions": [
    {
      "name": "foo_foreach_es",
      "action": "foreach",
      "origin": {
        "smt": "$:engrams",
        "pattern": {
          "match": {
            "tags": "bar"
          },
          "fields": [
            "smt",
            "fields"
          ]
        }
      },
      "terminal": {
        "smt": "elasticsearch|http://dev.dictadata.net:9200|foreach_transfer|=Foo",
        "options": {
          "encoding": "./test/data/input/engrams/foo_schema.engram.json"
        }
      },
      "actions": [
        {
          "name": "each_entry",
          "action": "transfer",
          "origin": {
            "smt": "=${smt}",
            "options": {
              "encoding": {
                "fields": "=${fields}"
              }
            },
            "pattern": {
              "match": {
                "Foo": "second"
              }
            }
          },
          "terminal": {
            "smt": "$:smt"
          }
        }
      ]
    },
    {
      "name": "bar_foreach",
      "action": "foreach",
      "origin": {
        "smt": "$:engrams",
        "pattern": {
          "match": {
            "tags": "bar"
          },
          "fields": [
            "smt",
            "fields"
          ]
        }
      },
      "terminal": {
        "smt": "json|./test/data/output/transfers/|foreach_transfer.json|*",
        "output": "./test/data/output/transfers/foreach_transfer.json"
      },
      "actions": [
        {
          "name": "each_entry",
          "action": "transfer",
          "origin": {
            "smt": "=${smt}",
            "options": {
              "encoding": {
                "fields": "=${fields}"
              }
            }
          },
          "terminal": {
            "smt": "$:smt"
          }
        }
      ]
    }
  ]
}
