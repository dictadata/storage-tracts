{
  "domain": "",
  "name": "voter_registration.tract",
  "type": "tract",
  "params": {
    "es_locus": "http://dev.dictadata.net:9200/",
    "year": "2024",
    "Mon": "Jan",
    "Y2": "24"
  },
  "config": {
    "engrams": {
      "smt": "elasticsearch|http://dev.dictadata.net:9200/|dicta_engrams|*",
      "options": {},
      "engrams_cache": {}
    },
    "plugins": {
      "junctions": {
        "@dictadata/pdf-junction": [
          "pdf"
        ]
      }
    }
  },
  "actions": [
    {
      "name": "state",
      "description": "load State Totals voter registrations to elasticsearch",
      "action": "transfer",
      "origin": {
        "smt": "pdf|/var/dictadata/US/IA/sos.iowa.gov/elections/pdf/VRStatsArchive/${year}/|Co${Mon}${Y2}.pdf|*",
        "options": {
          "cells": 10,
          "repeatingHeaders": true,
          "encoding": "./test/transfers/voter_registration_totals_county.engram.json"
        }
      },
      "transforms": [
        {
          "transform": "filter",
          "match": {
            "County": "Totals"
          }
        },
        {
          "transform": "mutate",
          "default": {
            "Name": "Iowa",
            "LSAD": "00",
            "STATE": "IA",
            "STATEFP": "19"
          },
          "map": {
            "Registered": "=Grand Total",
            "Active": "=Total Active",
            "Democratic": "=Democratic Active",
            "Republican": "=Republican Active",
            "Libertarian": "=Libertarian Active",
            "No Party": "=No Party Active",
            "Other": "=Other Active"
          }
        }
      ],
      "terminal": {
        "smt": "dicta:voter_registration"
      }
    },
    {
      "name": "county",
      "description": "load County voter registrations to elasticsearch",
      "action": "transfer",
      "origin": {
        "smt": "pdf|/var/dictadata/US/IA/sos.iowa.gov/elections/pdf/VRStatsArchive/${year}/|Co${Mon}${Y2}.pdf|*",
        "options": {
          "cells": 10,
          "repeatingHeaders": true,
          "encoding": "./test/transfers/voter_registration_totals_county.engram.json"
        }
      },
      "transforms": [
        {
          "transform": "filter",
          "drop": {
            "County": "Totals"
          }
        },
        {
          "transform": "adjoin",
          "lookup_table": {
            "smt": "census.gov:ansi_county",
            "pattern": {
              "match": {
                "STATE": "IA"
              },
              "count": 1000
            }
          },
          "lookup": {
            "COUNTYNAME": "=County+' County'"
          },
          "inject": [
            "COUNTYFP",
            "COUNTYNAME"
          ]
        },
        {
          "transform": "mutate",
          "default": {
            "Name": "=County",
            "LSAD": "06",
            "STATE": "IA",
            "STATEFP": "19"
          },
          "map": {
            "COUNTYFP": "=COUNTYFP",
            "Registered": "=Grand Total",
            "Active": "=Total Active",
            "Democratic": "=Democratic Active",
            "Republican": "=Republican Active",
            "Libertarian": "=Libertarian Active",
            "No Party": "=No Party Active",
            "Other": "=Other Active",
            "footnote": "=COUNTYNAME"
          }
        }
      ],
      "terminal": {
        "smt": "dicta:voter_registration"
      }
    },
    {
      "name": "congress",
      "description": "load Congressional District voter registrations to elasticsearch",
      "action": "transfer",
      "origin": {
        "smt": "pdf|/var/dictadata/US/IA/sos.iowa.gov/elections/pdf/VRStatsArchive/${year}/|Cong${Mon}${Y2}.pdf|*",
        "options": {
          "cells": 10,
          "repeatingHeaders": true,
          "encoding": "./test/transfers/voter_registration_totals_congressional.engram.json"
        }
      },
      "transforms": [
        {
          "transform": "filter",
          "match": {
            "County": "Total"
          }
        },
        {
          "transform": "counter"
        },
        {
          "transform": "adjoin",
          "lookup_table": {
            "smt": "census.gov:ansi_cd",
            "pattern": {
              "match": {
                "STATE": "IA"
              },
              "count": 100
            }
          },
          "lookup": {
            "CDFP": "=_count"
          },
          "inject": [
            "CDNAME",
            "CDFP"
          ]
        },
        {
          "transform": "mutate",
          "default": {
            "Name": "=CDNAME",
            "LSAD": "C2",
            "STATE": "IA",
            "STATEFP": "19"
          },
          "map": {
            "CDFP": "=CDFP",
            "Registered": "=Grand Total",
            "Active": "=Total Active",
            "Democratic": "=Democratic Active",
            "Republican": "=Republican Active",
            "Libertarian": "=Libertarian Active",
            "No Party": "=No Party Active",
            "Other": "=Other Active",
            "footnote": "=CDNAME"
          }
        }
      ],
      "terminal": {
        "smt": "dicta:voter_registration"
      }
    },
    {
      "name": "senate",
      "description": "load State Senate District voter registrations to elasticsearch",
      "action": "transfer",
      "origin": {
        "smt": "pdf|/var/dictadata/US/IA/sos.iowa.gov/elections/pdf/VRStatsArchive/${year}/|SS${Mon}${Y2}.pdf|*",
        "options": {
          "cells": 10,
          "repeatingHeaders": true,
          "encoding": "./test/transfers/voter_registration_totals_senate.engram.json"
        }
      },
      "transforms": [
        {
          "transform": "filter",
          "drop": {
            "County": "Totals"
          }
        },
        {
          "transform": "counter"
        },
        {
          "transform": "adjoin",
          "lookup_table": {
            "smt": "census.gov:ansi_sldu",
            "pattern": {
              "match": {
                "STATE": "IA"
              },
              "count": 200
            }
          },
          "lookup": {
            "SLDUST": "=_count"
          },
          "inject": [
            "SLDUST",
            "SLDUNAME"
          ]
        },
        {
          "transform": "mutate",
          "default": {
            "Name": "=State Senate District",
            "LSAD": "LU",
            "STATE": "IA",
            "STATEFP": "19"
          },
          "map": {
            "SLDUST": "=SLDUST",
            "Registered": "=Grand Total",
            "Active": "=Total Active",
            "Democratic": "=Democratic Active",
            "Republican": "=Republican Active",
            "Libertarian": "=Libertarian Active",
            "No Party": "=No Party Active",
            "Other": "=Other Active",
            "footnote": "=SLDUNAME"
          }
        }
      ],
      "terminal": {
        "smt": "dicta:voter_registration"
      }
    },
    {
      "name": "house",
      "description": "load State House District voter registrations to elasticsearch",
      "action": "transfer",
      "origin": {
        "smt": "pdf|/var/dictadata/US/IA/sos.iowa.gov/elections/pdf/VRStatsArchive/${year}/|SH${Mon}${Y2}.pdf|*",
        "options": {
          "cells": 10,
          "repeatingHeaders": true,
          "encoding": "./test/transfers/voter_registration_totals_house.engram.json"
        }
      },
      "transforms": [
        {
          "transform": "filter",
          "drop": {
            "County": "Totals"
          }
        },
        {
          "transform": "counter"
        },
        {
          "transform": "adjoin",
          "lookup_table": {
            "smt": "census.gov:ansi_sldl",
            "pattern": {
              "match": {
                "STATE": "IA"
              },
              "count": 500
            }
          },
          "lookup": {
            "SLDLST": "=State Representative District/(\\d{3})/$1"
          },
          "inject": [
            "SLDLST",
            "SLDLNAME"
          ]
        },
        {
          "transform": "mutate",
          "default": {
            "Name": "=State Representative District",
            "LSAD": "LL",
            "STATE": "IA",
            "STATEFP": "19"
          },
          "map": {
            "SLDLST": "=SLDLST",
            "Registered": "=Grand Total",
            "Active": "=Total Active",
            "Democratic": "=Democratic Active",
            "Republican": "=Republican Active",
            "Libertarian": "=Libertarian Active",
            "No Party": "=No Party Active",
            "Other": "=Other Active",
            "footnote": "=SLDLNAME"
          }
        }
      ],
      "terminal": {
        "smt": "dicta:voter_registration"
      }
    }
  ]
}
